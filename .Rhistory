runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
#file <- ('/Users/andrewpeters/Desktop/Garmin/Data/hyrox_avg_based.tcx')
#file <- ('./activities/Sample_HIIT.tcx')
#file <- ('/Users/andrewpeters/Downloads/heated_polar.tcx')
# ---- 1. Read and parse TCX file ----
tcx_xml <- read_xml(file)
xml_ns_strip(tcx_xml)
# ---- Check activity type ----
activity_node <- xml_find_first(tcx_xml, ".//Activity")
sport_type <- xml_attr(activity_node, "Sport")
#}
if (is.null(sport_type)) {
stop("❌ Could not detect an activity type in this TCX file.")
}
if (!(tolower(sport_type) %in% c("other", "hiit"))) {
stop(paste0("❌ This is a '", sport_type,
"' file — please upload a correct TCX file."))
}
hiit_trackpoints <- xml_find_all(activity_node, ".//Lap")
trackpoints <- xml_find_all(hiit_trackpoints, ".//Trackpoint")
hiit_data <- tibble(
time = sapply(trackpoints, function(x) xml_text(xml_find_first(x, ".//Time"))),
heart_rate = sapply(trackpoints, function(x) as.numeric(xml_text(xml_find_first(x, ".//HeartRateBpm/Value"))))
) %>%
mutate(time = as.POSIXct(time, format = "%Y-%m-%dT%H:%M:%OSZ", tz = "UTC"),
seconds_elapsed = as.numeric(time - first(time)))
hyrox_labels <- c("Run 1","SkiErg","Run 2","Sled Push","Run 3","Sled Pull","Run 4","Burpees","Run 5","Row","Run 6","Farmers Carry","Run 7","Lunges","Run 8","Wall Balls")
hiit_metadata <- tibble(
circuit_duration = sapply(hiit_trackpoints, function(x) xml_text(xml_find_first(x, ".//TotalTimeSeconds"))),
calories = sapply(hiit_trackpoints, function(x) as.numeric(xml_text(xml_find_first(x, ".//Calories")))),
avg_heartrate = sapply(hiit_trackpoints, function(x) xml_text(xml_find_first(x, ".//AverageHeartRateBpm"))),
max_heartrate = sapply(hiit_trackpoints, function(x) xml_text(xml_find_first(x, ".//MaximumHeartRateBpm"))),
) %>%
mutate(phase = hyrox_labels[row_number()]) %>%
mutate(start_sec = lag(cumsum(circuit_duration), default = 0),
end_sec = cumsum(circuit_duration))
hiit_joined <- fuzzy_left_join(
hiit_data,
hiit_metadata,
by = c("seconds_elapsed" = "start_sec", "seconds_elapsed" = "end_sec"),
match_fun = list(`>=`, `<=`)
) %>%
drop_na() %>%
mutate(Zone_Label = case_when(
heart_rate > 171 ~ "Zone 5",
heart_rate > 153 ~ "Zone 4",
heart_rate > 134 ~ "Zone 3",
heart_rate > 115 ~ "Zone 2",
TRUE ~ "Zone 1"
)) %>%
mutate(time_bin = floor(seconds_elapsed / 10))
hiit_joined$phase <- factor(hiit_joined$phase, levels = unique(hiit_joined$phase))
hr_stacked_bar <- hiit_joined %>%
mutate(Zone_Label = factor(Zone_Label, levels = c("Zone 5", "Zone 4", "Zone 3", "Zone 2", "Zone 1"))) %>%
group_by(phase, Zone_Label) %>%
summarise(avg_hr = mean(heart_rate), avg_count = n(), .groups = "drop") %>%
group_by(phase) %>%
mutate(total_count = sum(avg_count), prop = (avg_count / total_count) * 100) %>%
ungroup()
df <- data.frame(
station = c(
"Run 1", "Ski Erg", "Run 2", "Sled Push", "Run 3", "Sled Pull",
"Run 4", "Burpee Broad Jumps", "Run 5", "Row", "Run 6",
"Farmers Carry", "Run 7", "Sandbag Lunges", "Run 8", "Wall Balls"
),
time = rep("03:00", 16),
avg_time = c("5:02","4:35","4:44","3:27","5:08","5:05", "3:43","5:06","5:17","4:50","5:09","2:18","5:24","5:20","5:48","7:28"),
stringsAsFactors = FALSE
)
# ---- 1. Read and parse TCX file ----
tcx_xml <- read_xml(file)
xml_ns_strip(tcx_xml)
# ---- Check activity type ----
activity_node <- xml_find_first(tcx_xml, ".//Activity")
sport_type <- xml_attr(activity_node, "Sport")
#}
if (is.null(sport_type)) {
stop("❌ Could not detect an activity type in this TCX file.")
}
if (!(tolower(sport_type) %in% c("other", "hiit"))) {
stop(paste0("❌ This is a '", sport_type,
"' file — please upload a correct TCX file."))
}
hiit_trackpoints <- xml_find_all(activity_node, ".//Lap")
trackpoints <- xml_find_all(hiit_trackpoints, ".//Trackpoint")
hiit_data <- tibble(
time = sapply(trackpoints, function(x) xml_text(xml_find_first(x, ".//Time"))),
heart_rate = sapply(trackpoints, function(x) as.numeric(xml_text(xml_find_first(x, ".//HeartRateBpm/Value"))))
) %>%
mutate(time = as.POSIXct(time, format = "%Y-%m-%dT%H:%M:%OSZ", tz = "UTC"),
seconds_elapsed = as.numeric(time - first(time)))
hyrox_labels <- c("Run 1","SkiErg","Run 2","Sled Push","Run 3","Sled Pull","Run 4","Burpees","Run 5","Row","Run 6","Farmers Carry","Run 7","Lunges","Run 8","Wall Balls")
hiit_metadata <- tibble(
circuit_duration = sapply(hiit_trackpoints, function(x) xml_text(xml_find_first(x, ".//TotalTimeSeconds"))),
calories = sapply(hiit_trackpoints, function(x) as.numeric(xml_text(xml_find_first(x, ".//Calories")))),
avg_heartrate = sapply(hiit_trackpoints, function(x) xml_text(xml_find_first(x, ".//AverageHeartRateBpm"))),
max_heartrate = sapply(hiit_trackpoints, function(x) xml_text(xml_find_first(x, ".//MaximumHeartRateBpm"))),
) %>%
mutate(phase = hyrox_labels[row_number()]) %>%
mutate(start_sec = lag(cumsum(circuit_duration), default = 0),
end_sec = cumsum(circuit_duration))
hiit_joined <- fuzzy_left_join(
hiit_data,
hiit_metadata,
by = c("seconds_elapsed" = "start_sec", "seconds_elapsed" = "end_sec"),
match_fun = list(`>=`, `<=`)
) %>%
drop_na() %>%
mutate(Zone_Label = case_when(
heart_rate > 171 ~ "Zone 5",
heart_rate > 153 ~ "Zone 4",
heart_rate > 134 ~ "Zone 3",
heart_rate > 115 ~ "Zone 2",
TRUE ~ "Zone 1"
)) %>%
mutate(time_bin = floor(seconds_elapsed / 10))
hiit_joined$phase <- factor(hiit_joined$phase, levels = unique(hiit_joined$phase))
hr_stacked_bar <- hiit_joined %>%
mutate(Zone_Label = factor(Zone_Label, levels = c("Zone 5", "Zone 4", "Zone 3", "Zone 2", "Zone 1"))) %>%
group_by(phase, Zone_Label) %>%
summarise(avg_hr = mean(heart_rate), avg_count = n(), .groups = "drop") %>%
group_by(phase) %>%
mutate(total_count = sum(avg_count), prop = (avg_count / total_count) * 100) %>%
ungroup()
View(df)
View(hiit_metadata)
View(hiit_joined)
hyrox_labels <- c("Run 1","SkiErg","Run 2","Sled Push","Run 3","Sled Pull","Run 4","Burpees","Run 5","Row","Run 6","Farmers Carry","Run 7","Lunges","Run 8","Wall Balls")
avg_hyrox <- data.frame(phase = c("Run 1","SkiErg","Run 2","Sled Push","Run 3","Sled Pull","Run 4","Burpees","Run 5","Row","Run 6","Farmers Carry","Run 7","Lunges","Run 8","Wall Balls"),
avg_time = c("5:02","4:35","4:44","3:27","5:08","5:05", "3:43","5:06","5:17","4:50","5:09","2:18","5:24","5:20","5:48","7:28")) %>%
mutate(avg_seconds = as.numeric(ms(avg_time)))
format_mm_ss <- function(x) {
sign <- ifelse(x < 0, "-", "")
x_abs <- abs(x)
sprintf("%s%02d:%02d", sign, x_abs %/% 60, x_abs %% 60)
}
km_splits <- hiit_joined %>%
group_by(phase) %>%
summarise(
duration_secs = max(seconds_elapsed, na.rm = TRUE) - min(seconds_elapsed, na.rm = TRUE),
avg_hr = mean(heart_rate, na.rm = TRUE),
.groups = "drop"
) %>%
mutate(
duration_mins = duration_secs / 60,
duration_formatted = sprintf("%02d:%02d", duration_secs %/% 60, round(duration_secs %% 60))
) %>%
left_join(avg_hyrox, by = c('phase' = 'phase')) %>%
mutate(seconds_difference = avg_seconds - duration_secs,
diff_sec_formatted = format_mm_ss(seconds_difference),
faster = seconds_difference >= 0,
cum_avg_seconds = cumsum(seconds_difference))
km_splits <- df %>%
rename(phase = station) %>%
group_by(phase) %>%
summarise(
duration_secs = max(seconds_elapsed, na.rm = TRUE) - min(seconds_elapsed, na.rm = TRUE),
avg_hr = mean(heart_rate, na.rm = TRUE),
.groups = "drop"
) %>%
mutate(
duration_mins = duration_secs / 60,
duration_formatted = sprintf("%02d:%02d", duration_secs %/% 60, round(duration_secs %% 60))
) %>%
left_join(avg_hyrox, by = c('phase' = 'phase')) %>%
mutate(seconds_difference = avg_seconds - duration_secs,
diff_sec_formatted = format_mm_ss(seconds_difference),
faster = seconds_difference >= 0,
cum_avg_seconds = cumsum(seconds_difference))
df <- data.frame(
station = c("Run 1","SkiErg","Run 2","Sled Push","Run 3","Sled Pull","Run 4","Burpees","Run 5","Row","Run 6","Farmers Carry","Run 7","Lunges","Run 8","Wall Balls"),
time = rep("03:00", 16),
avg_time = c("5:02","4:35","4:44","3:27","5:08","5:05", "3:43","5:06","5:17","4:50","5:09","2:18","5:24","5:20","5:48","7:28"),
stringsAsFactors = FALSE
)
# ---- 1. Read and parse TCX file ----
tcx_xml <- read_xml(file)
xml_ns_strip(tcx_xml)
# ---- Check activity type ----
activity_node <- xml_find_first(tcx_xml, ".//Activity")
sport_type <- xml_attr(activity_node, "Sport")
#}
if (is.null(sport_type)) {
stop("❌ Could not detect an activity type in this TCX file.")
}
if (!(tolower(sport_type) %in% c("other", "hiit"))) {
stop(paste0("❌ This is a '", sport_type,
"' file — please upload a correct TCX file."))
}
hiit_trackpoints <- xml_find_all(activity_node, ".//Lap")
trackpoints <- xml_find_all(hiit_trackpoints, ".//Trackpoint")
hiit_data <- tibble(
time = sapply(trackpoints, function(x) xml_text(xml_find_first(x, ".//Time"))),
heart_rate = sapply(trackpoints, function(x) as.numeric(xml_text(xml_find_first(x, ".//HeartRateBpm/Value"))))
) %>%
mutate(time = as.POSIXct(time, format = "%Y-%m-%dT%H:%M:%OSZ", tz = "UTC"),
seconds_elapsed = as.numeric(time - first(time)))
hyrox_labels <- c("Run 1","SkiErg","Run 2","Sled Push","Run 3","Sled Pull","Run 4","Burpees","Run 5","Row","Run 6","Farmers Carry","Run 7","Lunges","Run 8","Wall Balls")
hiit_metadata <- tibble(
circuit_duration = sapply(hiit_trackpoints, function(x) xml_text(xml_find_first(x, ".//TotalTimeSeconds"))),
calories = sapply(hiit_trackpoints, function(x) as.numeric(xml_text(xml_find_first(x, ".//Calories")))),
avg_heartrate = sapply(hiit_trackpoints, function(x) xml_text(xml_find_first(x, ".//AverageHeartRateBpm"))),
max_heartrate = sapply(hiit_trackpoints, function(x) xml_text(xml_find_first(x, ".//MaximumHeartRateBpm"))),
) %>%
mutate(phase = hyrox_labels[row_number()]) %>%
mutate(start_sec = lag(cumsum(circuit_duration), default = 0),
end_sec = cumsum(circuit_duration))
hiit_joined <- fuzzy_left_join(
hiit_data,
hiit_metadata,
by = c("seconds_elapsed" = "start_sec", "seconds_elapsed" = "end_sec"),
match_fun = list(`>=`, `<=`)
) %>%
drop_na() %>%
mutate(Zone_Label = case_when(
heart_rate > 171 ~ "Zone 5",
heart_rate > 153 ~ "Zone 4",
heart_rate > 134 ~ "Zone 3",
heart_rate > 115 ~ "Zone 2",
TRUE ~ "Zone 1"
)) %>%
mutate(time_bin = floor(seconds_elapsed / 10))
hiit_joined$phase <- factor(hiit_joined$phase, levels = unique(hiit_joined$phase))
hr_stacked_bar <- hiit_joined %>%
mutate(Zone_Label = factor(Zone_Label, levels = c("Zone 5", "Zone 4", "Zone 3", "Zone 2", "Zone 1"))) %>%
group_by(phase, Zone_Label) %>%
summarise(avg_hr = mean(heart_rate), avg_count = n(), .groups = "drop") %>%
group_by(phase) %>%
mutate(total_count = sum(avg_count), prop = (avg_count / total_count) * 100) %>%
ungroup()
km_splits <- df %>%
rename(phase = station) %>%
group_by(phase) %>%
summarise(
duration_secs = max(seconds_elapsed, na.rm = TRUE) - min(seconds_elapsed, na.rm = TRUE),
avg_hr = mean(heart_rate, na.rm = TRUE),
.groups = "drop"
) %>%
mutate(
duration_mins = duration_secs / 60,
duration_formatted = sprintf("%02d:%02d", duration_secs %/% 60, round(duration_secs %% 60))
) %>%
left_join(avg_hyrox, by = c('phase' = 'phase')) %>%
mutate(seconds_difference = avg_seconds - duration_secs,
diff_sec_formatted = format_mm_ss(seconds_difference),
faster = seconds_difference >= 0,
cum_avg_seconds = cumsum(seconds_difference))
km_splits <- df %>%
mutate(time = as.POSIXct(time, format = "%M:%OSZ", tz = "UTC"),
seconds_elapsed = as.numeric(time - first(time)))
View(km_splits)
km_splits <- df %>%
mutate(time = as.POSIXct(time, format = "%M:%OS", tz = "UTC"),
seconds_elapsed = as.numeric(time - first(time)))
mutate(time = as.POSIXct(time, format = "%M:%OS", tz = "UTC"),
cumulative_time = cumsum(time),
seconds_elapsed = as.numeric(time - first(time)))
km_splits <- df %>%
mutate(time = as.POSIXct(time, format = "%M:%OS", tz = "UTC"),
seconds_elapsed = as.numeric(time))
km_splits <- df %>%
mutate(
seconds_elapsed = as.numeric(str_extract(time, "^[0-9]+")) * 60 +  # minutes × 60
as.numeric(str_extract(time, "(?<=:)\\d+(\\.\\d+)?"))  # seconds
)
km_splits <- df %>%
mutate(
seconds_elapsed = as.numeric(str_extract(time, "^[0-9]+")) * 60 +
as.numeric(str_extract(time, "(?<=:)\\d+(\\.\\d+)?")),
avg_seconds_elapsed = as.numeric(str_extract(avg_time, "^[0-9]+")) * 60 +
as.numeric(str_extract(avg_time, "(?<=:)\\d+(\\.\\d+)?"))
)
km_splits <- df %>%
mutate(
seconds_elapsed = as.numeric(str_extract(time, "^[0-9]+")) * 60 +
as.numeric(str_extract(time, "(?<=:)\\d+(\\.\\d+)?")),
avg_seconds_elapsed = as.numeric(str_extract(avg_time, "^[0-9]+")) * 60 +
as.numeric(str_extract(avg_time, "(?<=:)\\d+(\\.\\d+)?"))
) %>%
rename(phase = station) %>%
mutate(
duration_mins = duration_secs / 60,
duration_formatted = sprintf("%02d:%02d", duration_secs %/% 60, round(duration_secs %% 60))
) %>%
mutate(seconds_difference = avg_seconds - duration_secs,
diff_sec_formatted = format_mm_ss(seconds_difference),
faster = seconds_difference >= 0,
cum_avg_seconds = cumsum(seconds_difference))
km_splits <- df %>%
mutate(
seconds_elapsed = as.numeric(str_extract(time, "^[0-9]+")) * 60 +
as.numeric(str_extract(time, "(?<=:)\\d+(\\.\\d+)?")),
avg_seconds_elapsed = as.numeric(str_extract(avg_time, "^[0-9]+")) * 60 +
as.numeric(str_extract(avg_time, "(?<=:)\\d+(\\.\\d+)?"))
) %>%
rename(phase = station) %>%
mutate(
duration_mins = seconds_elapsed / 60,
duration_formatted = sprintf("%02d:%02d", seconds_elapsed %/% 60, round(seconds_elapsed %% 60))
) %>%
mutate(seconds_difference = avg_seconds_elapsed - seconds_elapsed,
diff_sec_formatted = format_mm_ss(seconds_difference),
faster = seconds_difference >= 0,
cum_avg_seconds = cumsum(seconds_difference))
ggplot(data = km_splits, aes(x = phase, y = seconds_difference, fill = faster)) +
geom_col(width = 0.9, color = "white", show.legend = F) +
geom_borderline(data = km_splits, aes(x = phase, y = cum_avg_seconds), group = 1, color = 'gray60', bordercolour = "white", linewidth = 1.5, borderwidth = 1, alpha = 0.5) +
geom_point(data = km_splits, aes(x = phase, y = cum_avg_seconds), shape = 21, color = 'white', fill = 'gray60', size = 3, stroke = 1.5 ) +
geom_col(width = 0.8, show.legend = F) +
geom_vline(xintercept = seq(0.5, length(unique(rd$hr_stacked_bar$phase)) + 0.5, 1), color = "gray90", linewidth = 0.5, linetype = "dashed") +
#Add Text
geom_shadowtext(data = km_splits %>% filter(faster == T), aes(label = diff_sec_formatted), size = 4, family = "Lato", color = '#379A8B', fontface = "bold", bg.colour = "white", bg.r = 0.03, nudge_y = 7, angle = 90) +
geom_shadowtext(data = km_splits %>% filter(!faster == T), aes(label = diff_sec_formatted), size = 4, family = "Lato", color = '#DB444B', fontface = "bold", bg.colour = "white", bg.r = 0.03, nudge_y = -7, angle = 90) +
geom_hline(aes(yintercept =  0), color = "gray60") +
scale_fill_manual(values = c("TRUE" = '#379A8B', "FALSE" = '#DB444B')) +
labs(
x = "Cumulative Time (minutes)",
) +
theme_minimal(base_family = "Lato") +
theme(
panel.background = element_rect(color = "white", fill = "white"),
plot.background = element_rect(color = "white", fill = "white"),
plot.subtitle = element_markdown(size = 20),
axis.text.x = element_blank(),
axis.text.y = element_blank(),
axis.title = element_blank(),
panel.grid = element_blank(),
legend.title = element_blank(),
legend.position = "bottom"
)
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
km_splits <- df %>%
mutate(
seconds_elapsed = as.numeric(str_extract(time, "^[0-9]+")) * 60 +
as.numeric(str_extract(time, "(?<=:)\\d+(\\.\\d+)?")),
avg_seconds_elapsed = as.numeric(str_extract(avg_time, "^[0-9]+")) * 60 +
as.numeric(str_extract(avg_time, "(?<=:)\\d+(\\.\\d+)?"))
) %>%
rename(phase = station) %>%
mutate(
duration_mins = seconds_elapsed / 60,
duration_formatted = sprintf("%02d:%02d", seconds_elapsed %/% 60, round(seconds_elapsed %% 60))
) %>%
mutate(seconds_difference = avg_seconds_elapsed - seconds_elapsed,
diff_sec_formatted = format_mm_ss(seconds_difference),
faster = seconds_difference >= 0,
cum_avg_seconds = cumsum(seconds_difference))
ggplot(data = km_splits, aes(x = phase, y = seconds_difference, fill = faster)) +
geom_col(width = 0.9, color = "white", show.legend = F) +
geom_borderline(data = km_splits, aes(x = phase, y = cum_avg_seconds), group = 1, color = 'gray60', bordercolour = "white", linewidth = 1.5, borderwidth = 1, alpha = 0.5) +
geom_point(data = km_splits, aes(x = phase, y = cum_avg_seconds), shape = 21, color = 'white', fill = 'gray60', size = 3, stroke = 1.5 ) +
geom_col(width = 0.8, show.legend = F) +
geom_vline(xintercept = seq(0.5, length(unique(rd$hr_stacked_bar$phase)) + 0.5, 1), color = "gray90", linewidth = 0.5, linetype = "dashed") +
#Add Text
geom_shadowtext(data = km_splits %>% filter(faster == T), aes(label = diff_sec_formatted), size = 4, family = "Lato", color = '#379A8B', fontface = "bold", bg.colour = "white", bg.r = 0.03, nudge_y = 7, angle = 90) +
geom_shadowtext(data = km_splits %>% filter(!faster == T), aes(label = diff_sec_formatted), size = 4, family = "Lato", color = '#DB444B', fontface = "bold", bg.colour = "white", bg.r = 0.03, nudge_y = -7, angle = 90) +
geom_hline(aes(yintercept =  0), color = "gray60") +
scale_fill_manual(values = c("TRUE" = '#379A8B', "FALSE" = '#DB444B')) +
labs(
x = "Cumulative Time (minutes)",
) +
theme_minimal(base_family = "Lato") +
theme(
panel.background = element_rect(color = "white", fill = "white"),
plot.background = element_rect(color = "white", fill = "white"),
plot.subtitle = element_markdown(size = 20),
axis.text.x = element_blank(),
axis.text.y = element_blank(),
axis.title = element_blank(),
panel.grid = element_blank(),
legend.title = element_blank(),
legend.position = "bottom"
)
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
shiny::runApp()
runApp()
shiny::runApp()
shiny::runApp()
