interval_nodes <- xml_find_all(activity_node, ".//Lap//Extensions")
View(activity_node)
View(hiit_trackpoints)
# ---- 1. Read and parse TCX file ----
#read_tcx_data <- function(file) {
tcx_xml <- read_xml(file)
xml_ns_strip(tcx_xml)
# ---- Check activity type ----
activity_node <- xml_find_first(tcx_xml, ".//Activity")
sport_type <- xml_attr(activity_node, "Sport")
#}
if (is.null(sport_type)) {
stop("❌ Could not detect an activity type in this TCX file.")
}
if (!(tolower(sport_type) %in% c("other", "hiit"))) {
stop(paste0("❌ This is a '", sport_type,
"' file — please upload a correct TCX file."))
}
hiit_trackpoints <- xml_find_all(activity_node, ".//Lap")
trackpoints <- xml_find_all(hiit_trackpoints, ".//Trackpoint")
#trackpoints <- xml_find_all(activity_node, ".//Trackpoint")
hiit_data <- tibble(
time = sapply(trackpoints, function(x) xml_text(xml_find_first(x, ".//Time"))),
heart_rate = sapply(trackpoints, function(x) as.numeric(xml_text(xml_find_first(x, ".//HeartRateBpm/Value"))))
) %>%
mutate(time = as.POSIXct(time, format = "%Y-%m-%dT%H:%M:%OSZ", tz = "UTC"),
seconds_elapsed = as.numeric(time - first(time)))
# Try extracting interval metadata
interval_nodes <- xml_find_all(activity_node, ".//Lap//Extensions")
#trackpoints <- xml_find_all(interval_nodes, ".//Trackpoint")
test_data <- tibble(
time = sapply(interval_nodes, function(x) xml_text(xml_find_first(x, ".//TPX"))),
#heart_rate = sapply(trackpoints, function(x) as.numeric(xml_text(xml_find_first(x, ".//HeartRateBpm/Value"))))
)
hiit_metadata <- tibble(
circuit_duration = as.numeric(xml_text(xml_find_all(interval_nodes, ".//TotalTimeSeconds"))),
avg_heartrate    = as.numeric(xml_text(xml_find_all(interval_nodes, ".//AverageHeartRateBpm/Value"))),
max_heartrate    = as.numeric(xml_text(xml_find_all(interval_nodes, ".//MaximumHeartRateBpm/Value")))
) %>%
mutate(
phase = if_else(row_number() == 1, "Warm-Up", paste0("Circuit ", row_number() - 1)),
start_sec = lag(cumsum(circuit_duration), default = 0),
end_sec = cumsum(circuit_duration)
)
# hiit_metadata <- tibble(
#   circuit_duration = sapply(hiit_trackpoints, function(x) xml_text(xml_find_first(x, ".//TotalTimeSeconds"))),
#   calories = sapply(hiit_trackpoints, function(x) as.numeric(xml_text(xml_find_first(x, ".//Calories")))),
#   avg_heartrate = sapply(hiit_trackpoints, function(x) xml_text(xml_find_first(x, ".//AverageHeartRateBpm"))),
#   max_heartrate = sapply(hiit_trackpoints, function(x) xml_text(xml_find_first(x, ".//MaximumHeartRateBpm"))),
# ) %>%
#   mutate(phase = if_else(row_number() == 1,
#                        "Warm-Up",
#                        paste0("Circuit ", row_number() - 1))) %>%
#   mutate(start_sec = lag(cumsum(circuit_duration), default = 0),
#   end_sec = cumsum(circuit_duration))
hiit_joined <- fuzzy_left_join(
hiit_data,
hiit_metadata,
by = c("seconds_elapsed" = "start_sec", "seconds_elapsed" = "end_sec"),
match_fun = list(`>=`, `<=`)
) %>% mutate(Zone_Label = case_when(
heart_rate > 171 ~ "Zone 5",
heart_rate > 153 ~ "Zone 4",
heart_rate > 134 ~ "Zone 3",
heart_rate > 115 ~ "Zone 2",
TRUE ~ "Zone 1"
))
#out <- read_tcx_data(file)
View(trackpoints)
hiit_trackpoints <- xml_find_all(activity_node, ".//Lap")
trackpoints <- xml_find_all(hiit_trackpoints, ".//Trackpoint")
trackpoints_test <- xml_find_all(activity_node, ".//Trackpoint")
View(trackpoints)
View(trackpoints_test)
View(hiit_trackpoints)
trackpoints_test <- xml_find_all(activity_node, ".//Step")
hiit_trackpoints <- xml_find_all(activity_node, ".//Lap")
trackpoints <- xml_find_all(hiit_trackpoints, ".//Trackpoint")
trackpoints_test <- xml_find_all(activity_node, ".//Interval")
trackpoints_test
trackpoints_test <- xml_find_all(activity_node, ".//Extensions")
trackpoints_test <- xml_find_all(activity_node, ".//TPX")
# Load your file
tcx_xml <- read_xml(file)
xml_ns_strip(tcx_xml)
# 1. See the overall structure
print(tcx_xml)
# 2. Look at all possible interval-related elements
xml_find_all(tcx_xml, "//*[contains(local-name(), 'Interval')]")
xml_find_all(tcx_xml, "//*[contains(local-name(), 'Step')]")
xml_find_all(tcx_xml, "//*[contains(local-name(), 'Segment')]")
xml_find_all(tcx_xml, "//*[contains(local-name(), 'Phase')]")
# 3. Check if trackpoints have different intensities or zones
trackpoints <- xml_find_all(tcx_xml, ".//Trackpoint")
intensities <- xml_text(xml_find_all(tcx_xml, ".//Trackpoint/Intensity"))
heart_rate_zones <- xml_text(xml_find_all(tcx_xml, ".//HeartRateZone"))
# 4. Look for workout structure outside of activities
workout_steps <- xml_find_all(tcx_xml, ".//Workout//Step")
trackpoints
intensities
heart_rate_zones
workout_steps
xml_find_all(tcx_xml, "//*[contains(local-name(), 'Interval')]")
xml_find_all(tcx_xml, "//*[contains(local-name(), 'Step')]")
xml_find_all(tcx_xml, "//*[contains(local-name(), 'Segment')]")
xml_find_all(tcx_xml, "//*[contains(local-name(), 'Phase')]")
tcx_xml
# Load your file
tcx_xml <- read_xml(file)
xml_ns_strip(tcx_xml)
# Extract all trackpoint data
trackpoints <- xml_find_all(tcx_xml, ".//Trackpoint")
# Create a comprehensive dataset from trackpoints
hiit_data <- data.frame(
time = xml_text(xml_find_all(tcx_xml, ".//Trackpoint/Time")),
hr = as.numeric(xml_text(xml_find_all(tcx_xml, ".//HeartRateBpm/Value"))),
stringsAsFactors = FALSE
)
# Convert time to POSIXct for easier analysis
hiit_data$time <- as.POSIXct(hiit_data$time, format = "%Y-%m-%dT%H:%M:%OSZ", tz = "UTC")
# Add additional metrics if available in TPX extensions
speed <- xml_text(xml_find_all(tcx_xml, ".//TPX/Speed"))
if(length(speed) > 0) {
hiit_data$speed <- as.numeric(speed)
}
watts <- xml_text(xml_find_all(tcx_xml, ".//TPX/Watts"))
if(length(watts) > 0) {
hiit_data$watts <- as.numeric(watts)
}
hiit_data
View(hiit_data)
trackpoints_test <- xml_find_all(activity_node, ".//StepType")
trackpoints_test
trackpoints_test <- xml_find_all(activity_node, ".//Step")
trackpoints_test
trackpoints_test <- xml_find_all(activity_node, ".//TPX")
trackpoints_test
trackpoints_test <- xml_find_all(activity_node, ".//Extension//TPX")
trackpoints_test
file <- "/Users/andrewpeters/Desktop/Garmin/Data/Sample_Splits.tcx"
file <- "/Users/andrewpeters/Desktop/Garmin/Data/test_HIIT.tcx"
ns <- xml_ns(activity_node)
trackpoints_test <- xml_find_all(
activity_node,
".//ns3:TPX",
ns
)
trackpoints_test
View(trackpoints_test)
file <- "/Users/andrewpeters/Desktop/Garmin/Data/Sample_Splits.tcx"
file <- "/Users/andrewpeters/Desktop/Garmin/Data/test_HIIT.tcx"
ns <- xml_ns(activity_node)
trackpoints_test <- xml_find_all(
activity_node,
".//ns3:TPX",
ns
)
hiit_data <- tibble(
time = sapply(trackpoints, function(x) xml_text(xml_find_first(x, ".//Time"))),
)
View(hiit_data)
file <- "/Users/andrewpeters/Desktop/Garmin/Data/Sample_Splits.tcx"
file <- "/Users/andrewpeters/Desktop/Garmin/Data/test_HIIT.tcx"
ns <- xml_ns(activity_node)
trackpoints_test <- xml_find_all(
activity_node,
".//ns3:TPX",
ns
)
hiit_data <- tibble(
time = sapply(trackpoints, function(x) xml_text(xml_find_first(x, ".//Interval"))),
)
View(hiit_data)
file <- "/Users/andrewpeters/Desktop/Garmin/Data/Sample_Splits.tcx"
file <- "/Users/andrewpeters/Desktop/Garmin/Data/test_HIIT.tcx"
# Extract namespaces
ns <- xml_ns(activity_node)
# Get all Trackpoints (because we need time stamps)
trackpoints <- xml_find_all(activity_node, ".//d1:Trackpoint", ns)
df <- map_df(trackpoints, function(tp) {
# Time for this trackpoint
time <- xml_text(xml_find_first(tp, ".//d1:Time", ns))
# Interval Type (may be StepType or Intensity depending on device)
tpx <- xml_find_first(tp, ".//ns3:TPX", ns)
interval_type <- xml_text(xml_find_first(tpx, ".//ns3:StepType", ns))
tibble(
time = ymd_hms(time),
interval_type = ifelse(interval_type == "", NA, interval_type)
)
})
df <- df %>% tidyr::fill(interval_type, .direction = "down")
file <- "/Users/andrewpeters/Desktop/Garmin/Data/Sample_Splits.tcx"
file <- "/Users/andrewpeters/Desktop/Garmin/Data/test_HIIT.tcx"
# Extract namespaces
ns <- xml_ns(activity_node)
# Get all Trackpoints (because we need time stamps)
trackpoints <- xml_find_all(activity_node, ".//d1:Trackpoint", ns)
df <- map_df(trackpoints, function(tp) {
# Time for this trackpoint
time <- xml_text(xml_find_first(tp, ".//d1:Time", ns))
# Interval Type (may be StepType or Intensity depending on device)
tpx <- xml_find_first(tp, ".//ns3:TPX", ns)
interval_type <- xml_text(xml_find_first(tpx, ".//ns3:StepType", ns))
tibble(
time = ymd_hms(time),
interval_type = ifelse(interval_type == "", NA, interval_type)
)
})
#df <- df %>% tidyr::fill(interval_type, .direction = "down")
trackpoints
file <- "/Users/andrewpeters/Desktop/Garmin/Data/Sample_Splits.tcx"
file <- "/Users/andrewpeters/Desktop/Garmin/Data/test_HIIT.tcx"
ns <- xml_ns(activity_node)
trackpoints_test <- xml_find_all(
activity_node,
".//ns3:TPX",
ns
)
hiit_data <- tibble(
time = sapply(trackpoints, function(x) xml_text(xml_find_first(x, ".//StepType"))),
)
View(hiit_data)
file <- "/Users/andrewpeters/Desktop/Garmin/Data/Sample_Splits.tcx"
file <- "/Users/andrewpeters/Desktop/Garmin/Data/test_HIIT.tcx"
ns <- xml_ns(activity_node)
trackpoints_test <- xml_find_all(
activity_node,
".//ns3:TPX",
ns
)
hiit_data <- tibble(
time = sapply(trackpoints, function(x) xml_text(xml_find_first(x, ".//ns3:StepType"))),
)
View(hiit_data)
file <- "/Users/andrewpeters/Desktop/Garmin/Data/Sample_Splits.tcx"
file <- "/Users/andrewpeters/Desktop/Garmin/Data/test_HIIT.tcx"
ns <- xml_ns(activity_node)
trackpoints_test <- xml_find_all(
activity_node,
".//ns3:TPX",
ns
)
hiit_data <- tibble(
time = sapply(trackpoints_test, function(x) xml_text(xml_find_first(x, ".//ns3:StepType"))),
)
View(hiit_data)
file <- "/Users/andrewpeters/Desktop/Garmin/Data/Sample_Splits.tcx"
file <- "/Users/andrewpeters/Desktop/Garmin/Data/test_HIIT.tcx"
ns <- xml_ns(activity_node)
trackpoints_test <- xml_find_all(
activity_node,
".//ns3:TPX",
ns
)
hiit_data <- tibble(
time = sapply(trackpoints_test, function(x) xml_text(xml_find_first(x, ".//StepType"))),
)
View(hiit_data)
file <- "/Users/andrewpeters/Desktop/Garmin/Data/Sample_Splits.tcx"
file <- "/Users/andrewpeters/Desktop/Garmin/Data/test_HIIT.tcx"
ns <- xml_ns(activity_node)
trackpoints_test <- xml_find_all(
activity_node,
".//ns3:TPX",
ns
)
# Extract unique child tag names under TPX
tpx_fields <- trackpoints_test |>
map(~ xml_children(.x)) |>
flatten() |>
map_chr(xml_name) |>
unique()
tpx_fields
hiit_data <- tibble(
time = sapply(trackpoints_test, function(x) xml_text(xml_find_first(x, ".//StepType"))),
)
tpx_fields
tpx_fields <- trackpoints_test |>
map(~ xml_children(.x))
tpx_fields
xml_ns(activity_node)
ns <- xml_ns(doc)
file <- "/Users/andrewpeters/Desktop/Garmin/Data/Sample_Splits.tcx"
file <- "/Users/andrewpeters/Desktop/Garmin/Data/test_HIIT.tcx"
ns <- xml_ns(activity_node)
ns <- xml_ns(file )
file <- "/Users/andrewpeters/Desktop/Garmin/Data/Sample_Splits.tcx"
file <- "/Users/andrewpeters/Desktop/Garmin/Data/test_HIIT.tcx"
ns <- xml_ns(activity_node)
ns <- xml_ns(activity_node)
xml_find_all(
activity_node,
".//d1:Trackpoint//ns3:StepType",
ns
)
f#ile <- "/Users/andrewpeters/Desktop/Garmin/Data/Sample_Splits.tcx"
#file <- "/Users/andrewpeters/Desktop/Garmin/Data/Sample_Splits.tcx"
file <- "/Users/andrewpeters/Desktop/Garmin/Data/test_HIIT.tcx"
tcx_xml <- read_xml(file)
xml_ns_strip(tcx_xml)
# ---- Check activity type ----
activity_node <- xml_find_first(tcx_xml, ".//Activity")
sport_type <- xml_attr(activity_node, "Sport")
ns <- xml_ns(activity_node)
xml_find_all(
activity_node,
".//d1:Trackpoint//ns3:StepType",
ns
)
xml_find_all(activity_node, ".//ns3:Intensity", ns)
xml_find_all(activity_node, ".//ns3:ActivityLap", ns)
xml_find_all(activity_node, ".//ns3:Step", ns)
#file <- "/Users/andrewpeters/Desktop/Garmin/Data/Sample_Splits.tcx"
#file <- "/Users/andrewpeters/Desktop/Garmin/Data/test_HIIT.tcx"
file <- "/Users/andrewpeters/Desktop/Garmin/Data/20903557417_ACTIVITY.fit"
install.packages("fitparser")
library(fitparser)
#file <- "/Users/andrewpeters/Desktop/Garmin/Data/Sample_Splits.tcx"
#file <- "/Users/andrewpeters/Desktop/Garmin/Data/test_HIIT.tcx"
file <- "/Users/andrewpeters/Desktop/Garmin/Data/20903557417_ACTIVITY.fit"
install.packages("FITfileR")
library(FITfileR)
if(!requireNamespace("remotes")) {
install.packages("remotes")
}
remotes::install_github("grimbough/FITfileR")
#file <- "/Users/andrewpeters/Desktop/Garmin/Data/Sample_Splits.tcx"
#file <- "/Users/andrewpeters/Desktop/Garmin/Data/test_HIIT.tcx"
file <- "/Users/andrewpeters/Desktop/Garmin/Data/20903557417_ACTIVITY.fit"
library(FITfileR)
fit <- readFitFile(file)
#file <- "/Users/andrewpeters/Desktop/Garmin/Data/Sample_Splits.tcx"
#file <- "/Users/andrewpeters/Desktop/Garmin/Data/test_HIIT.tcx"
file <- "/Users/andrewpeters/Downloads/20903557417_ACTIVITY.fit"
library(FITfileR)
fit <- readFitFile(file)
# Extract records
records <- getRecords(fit)
View(fit)
$ npm install fit-file-parser --save
npm install fit-file-parser --save
#file <- "/Users/andrewpeters/Desktop/Garmin/Data/Sample_Splits.tcx"
#file <- "/Users/andrewpeters/Desktop/Garmin/Data/test_HIIT.tcx"
file <- "/Users/andrewpeters/Downloads/20903557417_ACTIVITY.fit"
#install.packages("fitparser")
library(fitparser)
#file <- "/Users/andrewpeters/Desktop/Garmin/Data/Sample_Splits.tcx"
#file <- "/Users/andrewpeters/Desktop/Garmin/Data/test_HIIT.tcx"
file <- "/Users/andrewpeters/Downloads/20903557417_ACTIVITY.fit"
library(FITfileR)
fit <- readFitFile(file)
# Extract records
records <- getRecords(fit)
#file <- "/Users/andrewpeters/Desktop/Garmin/Data/Sample_Splits.tcx"
#file <- "/Users/andrewpeters/Desktop/Garmin/Data/test_HIIT.tcx"
file <- "/Users/andrewpeters/Downloads/20903557417_ACTIVITY.fit"
library(FITfileR)
fit <- readFitFile(file)
# Extract records
records <- getMessages(fit, "record")
# ---------------------------
# Garmin FIT HIIT Interval Extractor
# ---------------------------
# Load libraries
library(FITfileR)
library(dplyr)
library(lubridate)
# ---------------------------
# 1. Read FIT file
# ---------------------------
file <- "/Users/andrewpeters/Downloads/20903557417_ACTIVITY.fit"
fit <- readFitFile(file)
# ---------------------------
# 2. Extract trackpoint records (optional, for reference)
# ---------------------------
df_records <- records(fit)
# Inspect columns
head(df_records)
# ---------------------------
# 3. Extract HIIT workout step messages
# ---------------------------
df_events <- messages(fit, "event")
View(df_records)
# ---------------------------
# Garmin FIT HIIT Interval Extractor
# ---------------------------
# Load libraries
library(FITfileR)
library(dplyr)
library(lubridate)
# ---------------------------
# 1. Read FIT file
# ---------------------------
file <- "/Users/andrewpeters/Downloads/20903557417_ACTIVITY.fit"
fit <- readFitFile(file)
# ---------------------------
# 2. Extract all messages
# ---------------------------
all_messages <- fit$messages  # FITfileR stores all messages in fit$messages
# ---------------------------
# Garmin FIT HIIT Interval Extractor
# ---------------------------
# Load libraries
library(FITfileR)
library(dplyr)
library(lubridate)
# ---------------------------
# 1. Read FIT file
# ---------------------------
file <- "/Users/andrewpeters/Downloads/20903557417_ACTIVITY.fit"
fit <- readFitFile(file)
# ---------------------------
# 2. Extract record messages (trackpoints)
# ---------------------------
record_messages <- getRecordMessages(fit)  # correct accessor for trackpoints
library(FITfileR)
library(dplyr)
library(lubridate)
file <- "/Users/andrewpeters/Downloads/20903557417_ACTIVITY.fit"
fit  <- readFitFile(file)
# Extract records (trackpoints)
df_records_list <- records(fit)
df_records      <- bind_rows(df_records_list) %>%
arrange(timestamp)
# Extract event messages (HIIT/workout steps)
df_events <- events(fit) %>%
mutate(step_index  = workout_step,
event_type  = event_type,
timestamp   = timestamp,
timer_trig  = timer_trigger) %>%
filter(!is.na(step_index)) %>%
arrange(timestamp)
# ---------------------------
# Garmin FIT HIIT Interval Extractor - Generic Version
# ---------------------------
library(FITfileR)
library(dplyr)
library(lubridate)
# ---------------------------
# 1. Read FIT file
# ---------------------------
file <- "/Users/andrewpeters/Downloads/20903557417_ACTIVITY.fit"
fit  <- readFitFile(file)
# ---------------------------
# 2. Extract trackpoints (optional)
# ---------------------------
df_records <- bind_rows(records(fit)) %>% arrange(timestamp)
head(df_records)  # view columns like HR, cadence, speed, power, distance
# ---------------------------
# 3. Extract event messages
# ---------------------------
df_events <- events(fit) %>% arrange(timestamp)
# Inspect column names to see which may indicate intervals
cat("Columns in event messages:\n")
print(colnames(df_events))
cat("\nFirst few rows:\n")
print(head(df_events))
# ---------------------------
# 4. Detect interval step column
# ---------------------------
# Common possibilities: workout_step, event_group, data, step_index
possible_cols <- c("workout_step", "event_group", "data", "step_index")
interval_col   <- intersect(possible_cols, colnames(df_events))
if(length(interval_col) == 0){
stop("No interval/step column found in event messages. Check df_events manually.")
} else {
interval_col <- interval_col[1]  # take the first match
cat("Using column for intervals:", interval_col, "\n")
}
# ---------------------------
# 5. Filter HIIT steps and compute intervals
# ---------------------------
hiit_steps <- df_events %>%
filter(!is.na(.data[[interval_col]])) %>%
arrange(timestamp)
hiit_intervals <- hiit_steps %>%
group_by(step_index = .data[[interval_col]]) %>%
summarise(
start_time = min(timestamp, na.rm = TRUE),
end_time   = max(timestamp, na.rm = TRUE),
duration_s = as.numeric(difftime(max(timestamp, na.rm = TRUE),
min(timestamp, na.rm = TRUE),
units = "secs")),
step_type  = first(event_type),
.groups    = "drop"
)
# ---------------------------
# 6. Output
# ---------------------------
print(hiit_intervals)
write.csv(hiit_intervals, "HIIT_intervals.csv", row.names = FALSE)
# ---------------------------
# 7. Optional: merge HR, speed, cadence per interval
# ---------------------------
# This can be done if desired using df_records and hiit_intervals
View(hiit_intervals)
View(hiit_steps)
runApp()
runApp()
runApp()
# ---------------------------
# Garmin FIT HIIT Interval Extractor - Generic Version
# ---------------------------
library(FITfileR)
library(dplyr)
library(lubridate)
library(rvest)
url <- "https://results.hyrox.com/…your_event…"
page <- read_html(url)
table <- page %>% html_node("table.splits") %>% html_table()
page
runApp()
